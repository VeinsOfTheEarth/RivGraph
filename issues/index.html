<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Known issues &mdash; RivGraph 0.5.0 documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/sg_gallery.css" type="text/css" />
      <link rel="stylesheet" href="../_static/sg_gallery-binder.css" type="text/css" />
      <link rel="stylesheet" href="../_static/sg_gallery-dataframe.css" type="text/css" />
      <link rel="stylesheet" href="../_static/sg_gallery-rendered-html.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../_static/doctools.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Feature Development" href="../featuredevelopment/index.html" />
    <link rel="prev" title="Link and Node Dictionaries" href="../linksnodes/index.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html">
            <img src="../_static/rg_logo_full.png" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                0.5.0
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../quickstart/index.html">Quickstart</a></li>
<li class="toctree-l1"><a class="reference internal" href="../background/index.html">Background</a></li>
<li class="toctree-l1"><a class="reference internal" href="../install/index.html">Installation Instructions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../examples/index.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="../maskmaking/index.html">Maskmaking</a></li>
<li class="toctree-l1"><a class="reference internal" href="../shoreline/index.html">Shoreline creation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../linksnodes/index.html">Link and Node Dictionaries</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Known issues</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#shoreline-clipping-issues">Shoreline clipping issues</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#left-id-failure">Left id failure</a></li>
<li class="toctree-l3"><a class="reference internal" href="#non-point-intersection">Non-point intersection</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#mask-issues">Mask issues</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#skeleton-around-the-image-forming-a-cyclic-graph">Skeleton around the image forming a cyclic graph</a></li>
<li class="toctree-l3"><a class="reference internal" href="#multiple-inlet-nodes-after-assigning-directionality">Multiple inlet nodes after assigning directionality</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../featuredevelopment/index.html">Feature Development</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contributing/index.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../gallery/index.html">RivGraph in the wild</a></li>
<li class="toctree-l1"><a class="reference internal" href="../apiref/index.html">API Reference</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">RivGraph</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
      <li>Known issues</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/issues/index.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="known-issues">
<span id="issues"></span><h1>Known issues<a class="headerlink" href="#known-issues" title="Permalink to this heading"></a></h1>
<p>There are several known issues that new, and experienced, users may encounter. These may arise when some of the assumptions of RivGraph are violated, and this will serve as a resource to troubleshoot what is wrong. Many of these isues have been identified in the <a class="reference external" href="https://github.com/VeinsOfTheEarth/RivGraph/issues">issues page</a> and found during regular use of RivGraph. If you encounter more issues, please add them to the issues page.</p>
<section id="shoreline-clipping-issues">
<h2>Shoreline clipping issues<a class="headerlink" href="#shoreline-clipping-issues" title="Permalink to this heading"></a></h2>
<p>See <a class="reference internal" href="../shoreline/index.html"><span class="doc">Shoreline creation</span></a> further information on methods to generate a shoreline.</p>
<section id="left-id-failure">
<h3>Left id failure<a class="headerlink" href="#left-id-failure" title="Permalink to this heading"></a></h3>
<p>Shoreline features should not contain any attributes named left_fid, LEFT_ID, etc. which popular GIS software such as ArcGIS &amp; QGIS can add. It is recommended to enter a shoreline with a single attribute, id, with a null value inside to avoid an <a class="reference external" href="https://github.com/VeinsOfTheEarth/RivGraph/issues/9">error</a>.</p>
</section>
<section id="non-point-intersection">
<h3>Non-point intersection<a class="headerlink" href="#non-point-intersection" title="Permalink to this heading"></a></h3>
<p>An assumption of <a class="reference internal" href="../apiref/deltas.html#rivgraph.deltas.delta_utils.clip_by_shoreline" title="rivgraph.deltas.delta_utils.clip_by_shoreline"><code class="xref py py-obj docutils literal notranslate"><span class="pre">rivgraph.deltas.delta_utils.clip_by_shoreline</span></code></a> is that the channel skeleton and the shoreline intersect at a point, not at a line segment. If a shoreline was extracted using an automatic method such as the <a class="reference external" href="https://agupubs.onlinelibrary.wiley.com/doi/abs/10.1029/2008GL033963">Opening Angle Method</a>, a line intersection can arise. It’s recommended to smooth the shoreline, e.g. using <a class="reference external" href="https://gis.stackexchange.com/questions/24827/smoothing-polygons-in-contour-map">spline interpolation</a> or manually adjust the shoreline in that case to ensure point intersection.</p>
</section>
</section>
<section id="mask-issues">
<h2>Mask issues<a class="headerlink" href="#mask-issues" title="Permalink to this heading"></a></h2>
<p>The basics of maskmaking and mask assumptions are covered in the maskmaking documentation (<a class="reference internal" href="../maskmaking/index.html"><span class="doc">Maskmaking</span></a>), and this section details what happens when something goes awry.</p>
<section id="skeleton-around-the-image-forming-a-cyclic-graph">
<h3>Skeleton around the image forming a cyclic graph<a class="headerlink" href="#skeleton-around-the-image-forming-a-cyclic-graph" title="Permalink to this heading"></a></h3>
<p>As noted in the maskmaking documentation (<a class="reference internal" href="../maskmaking/index.html"><span class="doc">Maskmaking</span></a>), there should be no no-data pixels in the mask. This is because no-data pixels are treated as 1 (i.e. water), and <a class="reference external" href="https://github.com/VeinsOfTheEarth/RivGraph/issues/34">this can result</a> in a cyclical network which loops back to the delta apex. Here’s an example of the resulting skeleton where the teal is no data, blue is water, grey is land, yellow is the shoreline, and orange is the channel network skeleton after pruning. This issue can arise when projecting a mask from WGS84 (EPSG:4326) imagery to a local UTM zone, which results in the generation of triangular bands of no-data on the edge of the image. The NA values in the projected mask should be set as land (0) prior to running channel network skeletonization to prevent any issues.</p>
<img alt="https://user-images.githubusercontent.com/18738680/103107918-c4725d00-45f7-11eb-990f-c6b49bebeba9.png" src="https://user-images.githubusercontent.com/18738680/103107918-c4725d00-45f7-11eb-990f-c6b49bebeba9.png" />
</section>
<section id="multiple-inlet-nodes-after-assigning-directionality">
<h3>Multiple inlet nodes after assigning directionality<a class="headerlink" href="#multiple-inlet-nodes-after-assigning-directionality" title="Permalink to this heading"></a></h3>
<p>After successfully extracting the channel network and assigning flow directionality, an <a class="reference external" href="https://github.com/VeinsOfTheEarth/RivGraph/issues/52">error</a> that may arise when computing the delta metrics is an error that there are multiple inlet nodes found. This arises from an assumption built into RivGraph as of v0.4: the skeletonization of the mask will fill any islands 4 pixels or less, in a 4-neighbor sense, in the network. If these islands exist in the mask the skeleton can intersect one of these islands, which may in some instances cause an error. Here is an example of where this occurs and an issue arises. In the image below the link intersecting the island will have an <cite>wid_adj</cite> of zero, as the adjusted vector <cite>wid_pix</cite> will have a value of essentially zero.</p>
<img alt="https://user-images.githubusercontent.com/14874485/118341935-709cdd80-b4de-11eb-87a6-bbbc24fc8aec.png" src="https://user-images.githubusercontent.com/14874485/118341935-709cdd80-b4de-11eb-87a6-bbbc24fc8aec.png" />
<p>Without this hole-filling assumption the following skeleton would be generated:</p>
<img alt="https://user-images.githubusercontent.com/14874485/118342093-236d3b80-b4df-11eb-81b1-ec032d841e0e.png" src="https://user-images.githubusercontent.com/14874485/118342093-236d3b80-b4df-11eb-81b1-ec032d841e0e.png" />
<p>Depending on the analysis you are performing, it may or may not be appropriate to have the skeleton shown in the second case. This issue can arise in both the <code class="docutils literal notranslate"><span class="pre">delta</span></code> and the <code class="docutils literal notranslate"><span class="pre">river</span></code> skeletonization methods.</p>
<p>As changing this assumption may lead to unknown downstream changes in RivGraph’s functionality, there are no plans at this time to remove it from the skeletonization procedure.</p>
<p>Therefore there are several options available to treat this issue if it arises. If the island is relevant to the problem at hand, i.e. represents a significant feature in the network being analyzed:</p>
<ol class="arabic simple">
<li><p>Comment out the following three lines in <a class="reference internal" href="../apiref/rivgraph.html#rivgraph.mask_to_graph.skeletonize_mask" title="rivgraph.mask_to_graph.skeletonize_mask"><code class="xref py py-obj docutils literal notranslate"><span class="pre">rivgraph.mask_to_graph.skeletonize_mask()</span></code></a> for your relevant class:</p></li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">Iskel</span> <span class="o">=</span> <span class="n">imu</span><span class="o">.</span><span class="n">fill_holes</span><span class="p">(</span><span class="n">Iskel</span><span class="p">,</span> <span class="n">maxholesize</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
<span class="n">Iskel</span> <span class="o">=</span> <span class="n">morphology</span><span class="o">.</span><span class="n">skeletonize</span><span class="p">(</span><span class="n">Iskel</span><span class="p">)</span>
<span class="n">Iskel</span> <span class="o">=</span> <span class="n">simplify_skel</span><span class="p">(</span><span class="n">Iskel</span><span class="p">)</span>
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li><p>Downscale the mask such that the island becomes larger than 4 pixels. This will increase processing time, but for relatively small masks may not be significant.</p></li>
</ol>
<p>If the island doesn’t represent a significant feature in the network and could be removed:</p>
<ol class="arabic simple" start="3">
<li><p>Remove islands than 4 pixels during mask processing. The function <a class="reference internal" href="../apiref/rivgraph.html#rivgraph.im_utils.fill_holes" title="rivgraph.im_utils.fill_holes"><code class="xref py py-obj docutils literal notranslate"><span class="pre">rivgraph.im_utils.fill_holes()</span></code></a> provides this functionality.</p></li>
</ol>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../linksnodes/index.html" class="btn btn-neutral float-left" title="Link and Node Dictionaries" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../featuredevelopment/index.html" class="btn btn-neutral float-right" title="Feature Development" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2020, J. Schwenk &amp; J. Hariharan.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>